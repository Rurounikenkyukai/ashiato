<div style=" margin-top:200px;">

<%= link_to "管理者画面に戻る", admin_path(current_user) %>

<!-- ユーザ情報 -->
 <div>
  <h2>ユーザー情報</h2>
  <div>
    <div>
      <%= form_with(url: admin_search_path, method: :get, local: true) do |f| %>
        <%= f.text_field :content, :placeholder => "ニックネームを入力" %><%= f.submit "探す" %>
      <% end %>
    </div>
    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th>ユーザー画像</th>
          <th>名前</th>
          <th>編集画面</th>
          <th>ユーザー削除</th>
        </tr>
      </thead>
      <% @users.each do |user| %>
      <tbody>
        <tr>
          <td><%= attachment_image_tag user, :user_image,:fill, 60, 60, format: 'jpeg', fallback: "/images/no_image.jpg", size: "60x60" %></td>
          <td><%= user.nick_name %></td>
          <td><%= link_to "編集画面へ", edit_user_path(user.id) %></td>
          <td><%= link_to "削除", user_path(user.id), method: :'delete' %></td>
        </tr>
      </tbody>
      <% end %>
      <%= paginate @users,:param_name => 'user_page', class: "pagenate" %>
      </table>
  </div>

</div>

<!-- 管理者画面 -->
<div>
  <h2>購入履歴</h2>

  <%= form_with(url: admin_search_path, method: :get, local: true) do |f| %>
    <%= f.text_field :contents, :placeholder => "ユーザー名を入力"  %><%= f.submit "探す" %>
  <% end %>

  <table class="table table-striped table-bordered table-hover">
    <thead></thead>
    <button>購入詳細</button>
    <% @userss.each do |u| %>
    <% u.purchase_historys.each do |h| %>
    <tbody>
      <tr>
        <td><%= u.first_name %><%= u.last_name %></td>
        <td><%= h.purchase_at %></td>
        <td><%= h.send_status %></td>
        <td>
          <%= form_for (h) do |f| %>
            <label><%= f.radio_button :send_status, "受注" %>受注</label>
            <label><%= f.radio_button :send_status, "商品準備中" %>商品準備中</label>
            <label><%= f.radio_button :send_status, "出荷済み" %>出荷済み</label>
            <%= f.submit "ステータスを変更" %>
          <% end %>
          <div class="slide-div">
            <p>宛名:<%= h.send_name %></p>
            <p>宛先郵便番号:<%= h.send_postal_code %></p>
            <% total_price = 0 %>
            <% h.purchase_items.each do |p| %>
              CDタイトル<%= p.purchase_cd_title %>
              値段<%= p.purchase_cd_price %>円
              購入枚数<%= p.purchase_cd_quantity %>枚
              <% total_price += p.purchase_cd_quantity * p.purchase_cd_price %>
            <% end %>
            総計<%= total_price %>
          </div>
        </td>
        <% end %>
        <% end %>
    <%= paginate @userss,class: "pagenate" %>
  </table>
</div>

<!-- CD在庫画面 -->
<div>

  <h2 >CD在庫管理</h2>
    <%= form_with(url: admin_search_path, method: :get, local: true) do |f| %>
      <%= f.text_field :contentss, :placeholder => "CD名を入力" %><%= f.submit "探す" %>
    <% end %>

    <table class="table table-striped table-bordered table-hover">
      <thead>
        <tr>
          <th>CD名</th>
          <th>在庫数</th>
        </tr>
      </thead>
      <% @cds.each do |cd| %>
      <tbody>
        <tr>
          <td><%= cd.cd_title %></td>
          <td><%= cd.cd_stock %></td>
        </tr>
      </tbody>
      <% end %>
    </table>
    <%= paginate @cds,class: "pagenate" %>
</div>

</div>

<style type="text/css">
.slide-div {
  width: 150px;
  text-align: center;
  margin-left: 80%;
  border: #000 1px solid;
  display: none;
}
</style>
<script type="text/javascript">
$(document).ready(function() {
  $(document).on("click", "button", function() {
    if ( $(".slide-div").css("display") == "none" ) {
      $("button").text("閉じる");
      $(".slide-div").slideDown();
    } else {
      $("button").text("購入詳細");
      $(".slide-div").slideUp();
    }
  });
});
</script>
